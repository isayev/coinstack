---
description: MANDATORY - Consult specs/guides BEFORE changes, update docs AFTER changes
alwaysApply: true
---

# Documentation Sync Protocol (ZERO TOLERANCE)

## üö® CRITICAL REQUIREMENT üö®

**BEFORE any frontend/backend functionality change:**
1. ‚úÖ CONSULT relevant specs in `design/` folder
2. ‚úÖ CONSULT relevant guides in `docs/ai-guide/`
3. ‚úÖ UNDERSTAND existing patterns and behavior

**AFTER any functionality change:**
1. ‚úÖ UPDATE `docs/ai-guide/` to reflect ALL changes
2. ‚úÖ VERIFY documentation matches implementation
3. ‚úÖ ENSURE future developers can rely on docs as source of truth

**These documents are NOT optional reference - they are AUTHORITATIVE and MANDATORY.**

---

## Why This Rule Exists

**Problem**: Code evolves, but documentation gets stale. Stale docs ‚Üí wrong assumptions ‚Üí bugs ‚Üí wasted time.

**Solution**: Enforce strict documentation sync at EVERY change:
- Specs guide design decisions
- Docs reflect current implementation
- Future work builds on accurate foundation

**This is NON-NEGOTIABLE.**

---

## BEFORE Making ANY Changes (REQUIRED)

### Step 1: Consult Design Specs (for UI/Frontend work)

**ALWAYS check `design/` folder first for UI changes:**

| Change Type | Spec File |
|-------------|-----------|
| **Coin cards, grid layout** | `design/CoinStack Frontpage + Grid Design.md` |
| **Individual coin details** | `design/CoinStack Individual Coin Page Design.md` |
| **Table/list views** | `design/CoinStack Coin Table Design.md` |
| **Dashboard/statistics** | `design/CoinStack Statistics Dashboard Design.md` |
| **Colors, tokens, badges** | `design/CoinStack Design System v3.0.md` |

**If design spec exists ‚Üí FOLLOW IT. If behavior changes ‚Üí UPDATE SPEC.**

### Step 2: Consult AI Developer Guides

| Change Type | MUST Read First |
|-------------|-----------------|
| **Backend logic** | `docs/ai-guide/03-BACKEND-MODULES.md`, `08-CODING-PATTERNS.md` |
| **Domain entities** | `docs/ai-guide/04-DOMAIN-ENTITIES.md`, `05-DATA-MODEL.md` |
| **Frontend components** | `docs/ai-guide/04-FRONTEND-MODULES.md`, `11-FRONTEND-COMPONENTS.md` |
| **UI/Design changes** | `docs/ai-guide/10-DESIGN-SYSTEM.md`, `11-FRONTEND-COMPONENTS.md` |
| **API endpoints** | `docs/ai-guide/07-API-REFERENCE.md`, `06-DATA-FLOWS.md` |
| **Database schema** | `docs/ai-guide/05-DATA-MODEL.md`, `09-TASK-RECIPES.md` |
| **New feature** | `docs/ai-guide/09-TASK-RECIPES.md` + relevant module guide |

### Step 3: Understand Existing Behavior

- Read the relevant specs/sections **completely** (not just skim)
- Identify existing patterns and conventions
- Note any constraints or requirements
- Check for related components/modules
- **Ask yourself: "Will my change contradict documented behavior?"**

---

## AFTER Making Changes (REQUIRED - NOT OPTIONAL)

### Step 1: Identify ALL Changes Made

**Be thorough. Ask yourself:**
- Did I add/modify an API endpoint?
- Did I change the data model or schema?
- Did I add/modify a component?
- Did I change design tokens or UI patterns?
- Did I add/modify a service or use case?
- Did I change data flow or state management?
- Did I change component props, behavior, or styling?
- Did I add/remove files or restructure directories?

### Step 2: Update Documentation (MANDATORY)

**RULE: If you changed code, you MUST update docs. NO EXCEPTIONS.**

| Change Made | Update This Guide |
|-------------|-------------------|
| New API endpoint | `07-API-REFERENCE.md` |
| Modified API response | `07-API-REFERENCE.md` |
| New database field | `05-DATA-MODEL.md` |
| Schema migration | `05-DATA-MODEL.md`, `09-TASK-RECIPES.md` |
| New backend module | `03-BACKEND-MODULES.md` |
| New domain entity | `04-DOMAIN-ENTITIES.md` |
| New frontend component | `11-FRONTEND-COMPONENTS.md` |
| Component behavior change | `11-FRONTEND-COMPONENTS.md` |
| New design token | `10-DESIGN-SYSTEM.md` |
| UI pattern change | `10-DESIGN-SYSTEM.md` |
| New hook or store | `04-FRONTEND-MODULES.md` |
| Data flow change | `06-DATA-FLOWS.md` |
| New coding pattern | `08-CODING-PATTERNS.md` |

---

## Complete Guide Index

```
docs/ai-guide/
‚îú‚îÄ‚îÄ README.md                    # Navigation and quick start
‚îú‚îÄ‚îÄ 01-OVERVIEW.md               # Project context, domain terms
‚îú‚îÄ‚îÄ 02-CLEAN-ARCHITECTURE.md     # V2 architecture principles
‚îú‚îÄ‚îÄ 03-BACKEND-MODULES.md        # Backend layers and modules
‚îú‚îÄ‚îÄ 04-DOMAIN-ENTITIES.md        # Entities, value objects
‚îú‚îÄ‚îÄ 04-FRONTEND-MODULES.md       # Frontend architecture
‚îú‚îÄ‚îÄ 05-DATA-MODEL.md             # Database schema, ORM
‚îú‚îÄ‚îÄ 06-DATA-FLOWS.md             # Request flows, state
‚îú‚îÄ‚îÄ 06-FILE-LOCATIONS.md         # File reference
‚îú‚îÄ‚îÄ 07-API-REFERENCE.md          # API endpoints
‚îú‚îÄ‚îÄ 08-CODING-PATTERNS.md        # Code conventions
‚îú‚îÄ‚îÄ 08-CRITICAL-RULES.md         # Mandatory requirements
‚îú‚îÄ‚îÄ 09-TASK-RECIPES.md           # Step-by-step guides
‚îú‚îÄ‚îÄ 10-DESIGN-SYSTEM.md          # Design tokens, colors, specs
‚îî‚îÄ‚îÄ 11-FRONTEND-COMPONENTS.md    # Component reference
```

---

## Verification Checklist (Use This EVERY Time)

**Before committing ANY code change, verify:**

- [ ] I consulted relevant `design/` specs (for UI work)
- [ ] I consulted relevant `docs/ai-guide/` documents
- [ ] I understood existing patterns before coding
- [ ] My implementation follows documented conventions
- [ ] I identified ALL documentation that needs updating
- [ ] I updated `docs/ai-guide/` to reflect changes
- [ ] Documentation examples match current implementation
- [ ] Future developers can rely on docs as accurate

**If ANY checkbox is unchecked ‚Üí DO NOT commit. Fix documentation first.**

---

## Examples

### ‚úÖ CORRECT Workflow (Backend Change)

```
1. Task: Add "provenance_notes" field to Coin

2. BEFORE - Consult docs:
   üìñ CONSULTED BEFORE:
   - docs/ai-guide/05-DATA-MODEL.md ‚Üí Current Coin schema has 42 fields
   - docs/ai-guide/04-DOMAIN-ENTITIES.md ‚Üí Coin is aggregate root, uses value objects
   - docs/ai-guide/09-TASK-RECIPES.md ‚Üí Recipe: Add field ‚Üí domain ‚Üí ORM ‚Üí repo ‚Üí API

3. IMPLEMENT - Make changes:
   - Add provenance_notes: Optional[str] to Coin dataclass
   - Add provenance_notes: Mapped[Optional[str]] to CoinModel
   - Update _to_domain() and _from_domain() in repository
   - Add provenance_notes to CoinResponse Pydantic model
   - Add field to CoinForm in frontend

4. AFTER - Update docs:
   ‚úèÔ∏è UPDATED AFTER:
   - docs/ai-guide/05-DATA-MODEL.md ‚Üí Added provenance_notes field to Coin table spec
   - docs/ai-guide/07-API-REFERENCE.md ‚Üí Added provenance_notes to GET/POST/PUT schemas
   - docs/ai-guide/11-FRONTEND-COMPONENTS.md ‚Üí Added provenance_notes to CoinForm props
   - ‚úÖ VERIFIED: All docs match implementation
```

### ‚úÖ CORRECT Workflow (Frontend/UI Change)

```
1. Task: Change coin card to show rarity badge prominently

2. BEFORE - Consult specs AND guides:
   üìñ CONSULTED BEFORE:
   - design/CoinStack Frontpage + Grid Design.md ‚Üí Card spec: 360px √ó 170px, badges right-aligned
   - design/CoinStack Design System v3.0.md ‚Üí Rarity badge: 6px dot, gemstone colors
   - docs/ai-guide/10-DESIGN-SYSTEM.md ‚Üí Badge order: [Cert] [Grade] [Metal] [Rarity‚óè]
   - docs/ai-guide/11-FRONTEND-COMPONENTS.md ‚Üí CoinCardV3 props and structure

3. IMPLEMENT - Make changes:
   - Increase rarity dot from 6px to 8px in CoinCardV3.tsx
   - Update badge row spacing from 3px to 4px
   - Verify responsive behavior on mobile/desktop
   - Test with all rarity levels (common ‚Üí unique)

4. AFTER - Update docs:
   ‚úèÔ∏è UPDATED AFTER:
   - design/CoinStack Design System v3.0.md ‚Üí Updated rarity dot spec: 6px ‚Üí 8px
   - design/CoinStack Frontpage + Grid Design.md ‚Üí Updated badge spacing: 3px ‚Üí 4px
   - docs/ai-guide/10-DESIGN-SYSTEM.md ‚Üí Updated rarity indicator dimensions
   - docs/ai-guide/11-FRONTEND-COMPONENTS.md ‚Üí Updated CoinCardV3 badge styling
   - ‚úÖ VERIFIED: All visual specs match implementation
```

### ‚ùå INCORRECT Workflow (DO NOT DO THIS)

```
1. Task: Add new API endpoint for bulk coin import

2. ‚ùå SKIP consulting docs (assume I know the pattern)

3. IMPLEMENT:
   - Add POST /api/v2/coins/bulk endpoint
   - Use different response format than other endpoints
   - Code works, tests pass ‚úÖ

4. ‚ùå SKIP updating 07-API-REFERENCE.md
   - "I'll do it later"
   - "It's obvious from the code"

5. RESULT (3 months later):
   - Another developer needs bulk import
   - Checks 07-API-REFERENCE.md ‚Üí not documented
   - Implements DIFFERENT pattern
   - Now codebase has TWO inconsistent bulk import approaches
   - Tech debt accumulates
   - Team wastes time debugging confusion
```

**This is EXACTLY what we're preventing. Follow the protocol.**

---

## Enforcement (ZERO TOLERANCE)

### ‚ùå Violations (ALL are unacceptable)

1. **Making changes without consulting specs/guides first**
   - Result: Code contradicts documented patterns
   - Impact: Inconsistent implementation, confusion, bugs

2. **Implementing patterns that contradict documented conventions**
   - Result: Codebase diverges from standards
   - Impact: Maintenance nightmare, onboarding pain

3. **Adding/changing functionality without updating documentation**
   - Result: Documentation lies about current behavior
   - Impact: Future developers make wrong assumptions

4. **Leaving documentation outdated after changes**
   - Result: Docs become worthless
   - Impact: Loss of source of truth, wasted time

### ‚úÖ AI Assistant MUST (Not "should", MUST)

**BEFORE implementation:**
1. ‚úÖ EXPLICITLY STATE which specs/guides were read
2. ‚úÖ SUMMARIZE relevant constraints/patterns found
3. ‚úÖ CONFIRM approach aligns with documented conventions

**DURING implementation:**
4. ‚úÖ Follow documented patterns exactly
5. ‚úÖ Note any deviations (if absolutely necessary)

**AFTER implementation:**
6. ‚úÖ LIST which docs need updating
7. ‚úÖ ACTUALLY UPDATE the docs with accurate information
8. ‚úÖ VERIFY documentation matches implementation
9. ‚úÖ ENSURE examples/specs reflect new behavior

**FORMAT for communication:**
```
üìñ CONSULTED BEFORE:
- design/[spec-file.md] - [what I learned]
- docs/ai-guide/[guide.md] - [relevant patterns]

‚úèÔ∏è UPDATED AFTER:
- docs/ai-guide/[guide.md] - [what changed]
- [verification that docs match code]
```

### üö´ Consequences of Non-Compliance

**If this rule is violated:**
- Documentation becomes unreliable ‚Üí developers lose trust
- Specs become outdated ‚Üí design inconsistency
- Knowledge is lost ‚Üí onboarding takes longer
- Bugs multiply ‚Üí time wasted debugging assumptions

**This rule protects the codebase's long-term maintainability. It is NOT negotiable.**

---

## Related Design Specs

For UI/frontend work, also consult:

- `design/CoinStack Design System v3.0.md` - Master design specification
- `design/CoinStack Frontpage + Grid Design.md` - Grid layout specs
- `design/CoinStack Individual Coin Page Design.md` - Detail page specs
- `design/CoinStack Statistics Dashboard Design.md` - Dashboard specs
