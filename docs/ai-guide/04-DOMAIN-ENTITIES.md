# Domain Entities & Value Objects

## Overview

The Domain layer contains pure business entities with no dependencies on frameworks or infrastructure. Entities are mutable and have identity, while Value Objects are immutable and defined by their attributes.

**Modern Python:** We use `slots=True` on dataclasses for memory optimization and performance.

## Core Entities

### Coin (Aggregate Root)

**Location**: `src/domain/coin.py`

**Purpose**: Central domain entity representing a physical ancient coin in the collection.

**Structure**:
```python
@dataclass
class Coin:
    # Identity
    id: int | None

    # Classification
    category: Category
    metal: Metal
    denomination: str | None = None
    portrait_subject: str | None = None

    # Value Objects (Encapsulated Data)
    dimensions: Dimensions
    attribution: Attribution
    grading: GradingDetails
    acquisition: AcquisitionDetails | None = None
    design: Design | None = None
    
    # Enrichment (LLM Data)
    enrichment: EnrichmentData | None = None

    # Research Grade Extensions
    issue_status: IssueStatus = IssueStatus.OFFICIAL
    die_info: DieInfo | None = None
    monograms: List[Monogram] = field(default_factory=list)
    secondary_treatments: List[Dict[str, Any]] | None = None
    find_data: FindData | None = None

    # Collections
    images: List[CoinImage] = field(default_factory=list)
    references: List[CatalogReference] = field(default_factory=list)
    provenance: List[ProvenanceEntry] = field(default_factory=list)

    # Metadata
    description: str | None = None
    storage_location: str | None = None
    personal_notes: str | None = None
    rarity: str | None = None
    rarity_notes: str | None = None
```

## Value Objects

Value Objects are **immutable** (`frozen=True`) and optimized (`slots=True`).

### EnrichmentData (NEW)

**Location**: `src/domain/coin.py`

**Purpose**: Encapsulates data generated by LLM analysis.

```python
@dataclass(frozen=True, slots=True)
class EnrichmentData:
    historical_significance: str | None = None
    enriched_at: str | None = None
    analysis_sections: str | None = None     # JSON-encoded analysis
    suggested_references: List[str] | None = None
    suggested_rarity: Dict[str, Any] | None = None
    suggested_design: Dict[str, Any] | None = None
    suggested_attribution: Dict[str, Any] | None = None
```

### Dimensions

```python
@dataclass(frozen=True, slots=True)
class Dimensions:
    diameter_mm: Decimal
    weight_g: Decimal | None = None
    die_axis: int | None = None
    specific_gravity: Decimal | None = None
```

### Attribution

```python
@dataclass(frozen=True, slots=True)
class Attribution:
    issuer: str
    issuer_id: int | None = None
    mint: str | None = None
    mint_id: int | None = None
    year_start: int | None = None
    year_end: int | None = None
```

### Design (NEW)

```python
@dataclass(frozen=True, slots=True)
class Design:
    obverse_legend: str | None = None
    obverse_description: str | None = None
    reverse_legend: str | None = None
    reverse_description: str | None = None
    exergue: str | None = None
```

### CatalogReference

```python
@dataclass(frozen=True, slots=True)
class CatalogReference:
    catalog: str              # "RIC", "RPC"
    number: str               # "207"
    volume: str | None = None # "I", "II"
    suffix: str | None = None
    raw_text: str = ""
    is_primary: bool = False
    # ... variants, mints, supplements
```

### ProvenanceEntry

```python
@dataclass(frozen=True, slots=True)
class ProvenanceEntry:
    source_type: str          # "auction", "dealer"
    source_name: str          # "Heritage"
    event_date: date | None = None
    lot_number: str | None = None
    notes: str | None = None
    raw_text: str = ""
```

## Scraper Domain

### ScrapeResult (Generic)

**Location**: `src/domain/services/scraper_service.py`

**Purpose**: Standardized result type for all scraping operations, handling success, failure, and blocking states.

```python
class ScrapeStatus(str, Enum):
    SUCCESS = "success"
    NOT_FOUND = "not_found"
    BLOCKED = "blocked"
    ERROR = "error"

@dataclass
class ScrapeResult(Generic[T]):
    status: ScrapeStatus
    data: Optional[T] = None
    error_message: Optional[str] = None
```

### AuctionLot

**Location**: `src/domain/auction.py`

**Purpose**: Represents raw auction data before conversion to Coin.

```python
@dataclass
class AuctionLot:
    source: str
    lot_id: str
    url: str
    sale_name: str
    lot_number: str
    hammer_price: Optional[Decimal] = None
    estimate_low: Optional[Decimal] = None
    estimate_high: Optional[Decimal] = None
    currency: str = "USD"
    # ... mapped fields ...
```

---

**Next:** [05-DATA-MODEL.md](05-DATA-MODEL.md) - Database schema
